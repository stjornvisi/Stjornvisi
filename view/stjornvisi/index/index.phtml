<?php
use Stjornvisi\Properties\FileProperties;
use \Stjornvisi\View\Helper\Date;
?>

<?if(!$this->identity):?>
<header class="panel panel--hero">
	<div class="panel__container">
		<div class="panel__content">
			<a href="/" class="logo">
				<h1>Stjórnvísi</h1>
				<img src="<?=$this->basePath("/themes/2016/stylesheets/images/logo-white.png")?>" alt="Stjórnvísi">
			</a>
			<div class="box">
				<div class="box__title"><h2>Framsækin stjórnun</h2></div>
				<div class="box__content">
					<p>Boudin filet mignon jowl, short loin hamburger leberkas porchetta rump brisket ball tip. Pork andouille pork loin tenderloin shankle salami. Beef ribs flank salami andouille brisket ground round brisket bresaola hamburger ham.
						shankle. Tail tri-tip pastrami, landjaeger pork loin boudin turkey ham sirloin drumstick</p>
					<p><a href="#">Hvaða fyrirtæki eru aðilar að Stjórnvísi?</a></p>
					<p><a href="/adgangur/stofna" class="btn btn-primary">Stofna aðgang</a></p>
					<p><a href="/innskra" class="login btn btn-info">Innskráning <i class="fa fa-unlock-alt"></i></a></p>
				</div>
			</div>
		</div>
	</div>
</header>
<?=$this->render('layout/_navigation.phtml')?>
<?endif?>

<div class="panel panel--columns-two">
	<div class="panel__container">
		<div class="panel__content">
			<div class="box box--news">
				<div class="box__title"><h2>Fréttir af Stjórnvísi</h2></div>
				<div class="box__content">
					<? /** @var \Stjornvisi\Service\News $news */ foreach ($this->news as $i => $news): ?>
						<? if($i < \Stjornvisi\Service\News::FRONT_NEWS_COUNT) : ?>
						<div class="entry<?if($news->avatar):?> entry--has-image<?endif?> entry--border">
							<div class="entry__info"><?=$this->date($news->created_date,Date::FORMAT_DATE_TIME)?></div>
							<div class="entry__title"><h3><a href="<?=$this->url('frettir/index',array('id'=>$news->id))?>"><?=$news->title?></a></h3></div>
							<div class="entry__image">
								<?php if($news->avatar):?>
									<a href="<?=$this->url('frettir/index',array('id'=>$news->id))?>" class="block-element__poster">
										<?=$this->image($news->avatar, FileProperties::DIR_LARGE);?>
									</a>
								<?php endif;?>
							</div>
							<div class="entry__content truncate">
								<?=$news->body?>
							</div>
						</div>
						<? else: ?>
						<div class="entry entry--simple entry--border">
							<div class="entry__info"><?=$this->date($news->created_date,Date::FORMAT_DATE_TIME)?></div>
							<div class="entry__title"><h3><a href="<?=$this->url('frettir/index',array('id'=>$news->id))?>"><?=$news->title?></a></h3></div>
						</div>
						<? endif; ?>
					<? endforeach; ?>
				</div>
				<div class="box__footer">
					<a href="#"><i class="fa fa-plus-circle"></i> <a href="<?=$this->url('frettir')?>">Skoða fleiri fréttir og pistla</a></a>
				</div>
			</div>
			<div class="box box--events">
				<div class="box__title"><h2>Viðburðir á næstunni</h2></div>
				<div class="box__content">
					<? /** @var \Stjornvisi\Service\Event $event */ foreach ($this->events as $event): ?>
						<div class="entry">
							<div class="entry__title">
								<div class="entry__date">
									<span class="day"><?=$this->date($event->event_date, Date::FORMAT_DAY)?></span>
									<span class="month"><?=$this->date($event->event_date, Date::FORMAT_MONTH_SHORT)?></span>
									<span class="year"><?=$this->date($event->event_date, Date::FORMAT_YEAR)?></span>
								</div>
								<h3><a href="<?=$this->url('vidburdir/index',array('id'=>$event->id))?>"><?=$event->subject?></a></h3>
								<div class="entry__info">
									<i class="fa fa-clock-o"></i>
									<? if($event->event_time) : ?>
										<?=$event->event_time->format("H:i")?>
										<? if($event->event_end) : ?>
											- <?=$event->event_end->format("H:i")?>
										<? endif; ?>
									<? endif; ?>
									<? if($event->location) : ?>
										<span class="separator">/</span>
										<i class="fa fa-map-marker"></i> <?=$event->location?>
									<? endif; ?>
								</div>
							</div>
							<div class="entry__content">
								<?=$this->paragrapher(mb_substr($event->body,0,200,'utf-8').'&#8230;'  );?>
								<?php if($this->identity()): ?>
									<?php if($event->attending === false):?>
										<a href="<?=$this->url('vidburdir/attending',array('id'=>$event->id,'type'=>0))?>"  class="btn btn-default">Afskrá mætingu</a>
										<a href="<?=$this->url('vidburdir/attending',array('id'=>$event->id,'type'=>1))?>" class="btn btn-primary">Skrá mætingu</a>
									<?php elseif($event->attending == 0):?>
										<a href="<?=$this->url('vidburdir/attending',array('id'=>$event->id,'type'=>1))?>" class="btn btn-primary">Skrá mætingu</a>
									<?php elseif($event->attending == 1):?>
										<a href="<?=$this->url('vidburdir/attending',array('id'=>$event->id,'type'=>0))?>" class="btn btn-default">Afskrá mætingu</a>
									<?php endif;?>
								<?php endif;?>
							</div>
						</div>
					<? endforeach; ?>
				</div>
				<div class="box__footer">
					<a href="<?=$this->url('vidburdir')?>">
						<i class="fa fa-plus-circle"></i> Skoða alla <?=$this->eventCount?> viðburði næsta mánuðinn
					</a>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="panel panel--inset">
	<div class="panel__container">
		<div class="panel__content">
			<div class="box box--carousel">
				<div class="box__jip">
					<!--
					<a href="<?=$this->url('vidburdir')?>" class="landing-page__headline"><i class="fa fa-plus-circle"></i> Yfirlit liðinna viðburða</a>
					<a href="#"> </a>
					-->
				</div>
				<div class="box__title"><h2>Eldri viðburðir</h2></div>
				<div class="box__content owl-carousel">
					<? foreach ($this->eventsPassed as $event) : ?>
						<div class="entry">
							<div class="entry__info">
								<?=$this->date($event->event_date)?>
							</div>
							<div class="entry__title">
								<h3><a href="<?=$this->url('vidburdir/index',array('id'=>$event->id))?>"><?=$event->subject?></a></h3>
							</div>
							<div class="entry__image">
								<?php if($event->avatar):?>
									<a class="block-element__poster" href="<?=$this->url('vidburdir/index',array('id'=>$event->id))?>">
										<?=$this->image($event->avatar, FileProperties::DIR_LARGE);?>
									</a>
								<?php endif;?>
							</div>
							<div class="entry__content">
								<?=$this->paragrapher(mb_substr($event->body,0,200,'utf-8').'&#8230;');?>
							</div>
						</div>
					<? endforeach; ?>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="panel panel--groups">
	<div class="panel__container">
		<div class="panel__content panel--row">
			<div class="box">
				<div class="box__title"><h2>Yfirlit faghópa</h2></div>
				<div class="box__content">
					<ul class="legend">
						<li><i class="fa fa-calendar-o"></i>Einn eða fleiri viðburðir síðustu 3 mánuði</li>
						<li><i class="fa fa-check"></i>Þínir hópar</li>
					</ul>
					<div class="entry">
						<div class="entry__title"><h3>Kjarnastarf Stjórnvísis fer fram í þeim <?=count($this->groups)?> faghópum sem eru starfandi innan félagsins á jafnmjörgum sviðum stjórnunar.</h3></div>
						<div class="entry__content">
							<p>Tail strip steak salami, ball tip jerky tenderloin meatball. Shankle turkey shank, venison strip steak alcatra pastrami. Shankle alcatra porchetta cow drumstick kielbasa, turkey pork chop beef leberkas andouille rump pig.</p>
							<p>Flank swine alcatra bacon chicken beef kielbasa pork loin ham doner turducken ham hock pork beef ribs chuck. Andouille capicola strip steak pancetta fatback salami spare ribs kevin brisket drumstick beef ribs pastrami.</p>
							<p>T-bone pig venison, landjaeger alcatra turkey turducken short ribs ham hock kevin andouille pork chop prosciutto sirloin. Andouille tenderloin beef ribs, brisket alcatra chuck pork turkey sausage flank ball tip.</p>
						</div>
					</div>
				</div>
			</div>
			<div class="box">
				<div class="box__content">
					<?foreach ($this->groups as $group) : ?>
						<div class="entry entry--hoverable">
							<div class="entry__title">
								<div class="entry__status">
									<i class="fa<?=(null !== $group->user_id) ? ' fa-check' : ''?>"></i>
								</div>
								<h4>
									<?=$group->name_short?>
								<? if ($group->event_count > 0 ): ?>
								<span class="fa-stack">
									<i class="fa fa-calendar-o fa-stack-2x"></i>
									<i class="fa-stack-1x"><?=$group->event_count?></i>
								</span>
								<? endif; ?>
								</h4>
							</div>
							<? if (count($group->events) || $group->event_count || count($group->board)) :?>
							<div class="entry__content">
								<div class="event">
									<? if (count($group->events)) : ?>
									<? /** @var \Stjornvisi\Service\Event $nextEvent */ $nextEvent = array_pop($group->events)?>
									<div class="event__label"><h4><i class="fa fa-calendar-o"></i>Næsti viðburður</h4></div>
									<div class="event__info">
										<span class="entry__date"><?=$this->date($nextEvent->event_date)?></span>
										<span class="separator">/</span>
										<span class="event__time">
										<? if($nextEvent->event_time) : ?>
											<?=$nextEvent->event_time->format("H:i")?>
											<? if($nextEvent->event_end) : ?>
												- <?=$nextEvent->event_end->format("H:i")?>
											<? endif; ?>
										<? endif; ?>
										</span>
									</div>
									<div class="event__title">
										<h5><a href="<?=$this->url('vidburdir/index',array('id'=>$nextEvent->id))?>"><?=$nextEvent->subject?></a></h5>
									</div>
									<? endif; ?>
									<? if ($group->event_count > 0) : ?>
									<div class="event__details"><a href="#"><?=$group->event_count?> viðburðir síðustu 3 mánuði</a></div>
									<? endif; ?>
									<? if (count($group->board)) : ?>
									<div class="event__content">
										<h4>Stjórn</h4>
										<p>
											<? $i = 0; foreach ($group->board as $member) : ?>
											<?=($i !=0 ) ? '<br>' : ''?>
											<a href="<?=$this->url('notandi',array('id'=>$member->id))?>"><?=$member->name?></a>,
												<a href="<?=$this->url('fyrirtaeki',array('id'=>$member->company_id))?>"><?=$member->company_name?></a>
											<? $i++; endforeach; ?>
										</p>
									</div>
										<? if (null !== $this->identity) : ?>
											<? if (null === $group->user_id) : ?>
												<a href="<?=$this->url('hopur/register',array('id'=>$group->url,'type'=>1))?>" class="btn btn-default">Skrá mig í þennan hóp</a>
											<?php else:?>
												<a href="<?=$this->url('hopur/register',array('id'=>$group->url,'type'=>0))?>" class="btn btn-default">Afskrá mig úr þessum hóp</a>
											<?php endif;?>
										<? endif; ?>
									<? endif; ?>
								</div>
							</div>
							<? endif; ?>
						</div>
					<?endforeach;?>
				</div>
			</div>
		</div>
	</div>
</div>
